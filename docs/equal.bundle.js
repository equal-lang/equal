var equal;(()=>{var t={456:()=>{}},e={};function r(n){var i=e[n];if(void 0!==i)return i.exports;var o=e[n]={exports:{}};return t[n](o,o.exports,r),o.exports}r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};(()=>{"use strict";r.r(n),r.d(n,{Equal:()=>Q});var t,e=r(456);!function(t){t.START_TAG_LEFT="START_TAG_LEFT",t.END_TAG_LEFT="END_TAG_LEFT",t.TAG_RIGHT="TAG_RIGHT",t.EQUAL_SIGN="EQUAL_SIGN",t.TAGNAME="TAGNAME",t.ATTRIBUTE="ATTRIBUTE",t.TEXT="TEXT",t.VALUE="VALUE",t.DOCTYPE="DOCTYPE",t.EOF="EOF"}(t||(t={}));var i,o=function(t,e,r){this.tokenType=t,this.value=r,this.line=e};!function(t){t.AND="AND",t.OR="OR",t.EQUAL="EQUAL",t.NOT_EQUAL="NOT_EQUAL",t.GREATER_THAN="GREATER_THAN",t.LESSER_THAN="LESSER_THAN",t.PLUS="PLUS",t.MINUS="MINUS",t.MULTIPLY="MULTIPLY",t.DIVIDE="DIVIDE",t.NOT="NOT"}(i||(i={}));var s,h,a=(new Map).set("&&","AND").set("||","OR").set("==","EQUAL").set("!=","NOT_EQUAL").set(">","GREATER_THAN").set("<","LESSER_THAN").set("+","PLUS").set("-","MINUS").set("*","MULTIPLY").set("/","DIVIDE").set("!","NOT"),c=(s=function(t,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},s(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),u=function(){function t(){}return t.prototype.print=function(t){return t.accept(this)},t.prototype.visitSyntaxError=function(t){return"SyntaxError at "+this.toString(t)},t.prototype.visitRuntimeError=function(t){return"RuntimeError at "+this.toString(t)},t.prototype.visitUnexpectedError=function(t){return"Unexpected Error: "+t.message+"\nPlease report the bug at https://github.com/equal-lang/equal/issues\n(To view the stack trace, run the interpreter again in verbose mode)"},t.prototype.toString=function(t){return t.file+":"+t.line+": "+t.message},t}(),p=function(t){function e(r,n,i){var o=t.call(this,r)||this;return Object.setPrototypeOf(o,e.prototype),o.name="EqualError",o.message=r,o.file=null==n?"Unknown":n,o.line=null==i?0:i,o}return c(e,t),e.prototype.accept=function(t){if(void 0===(e=t).visitSyntaxError||void 0===e.visitRuntimeError||void 0===e.visitUnexpectedError)throw new Error("Invalid visitor type");var e},e}(Error),l=function(t){function e(r,n,i){var o=t.call(this,r,n,i)||this;return Object.setPrototypeOf(o,e.prototype),o.name="EqualSyntaxError",o}return c(e,t),e.prototype.accept=function(e){return t.prototype.accept.call(this,e),e.visitSyntaxError(this)},e}(p),f=function(t){function e(r,n,i){var o=t.call(this,r,n,i)||this;return Object.setPrototypeOf(o,e.prototype),o.name="EqualRuntimeError",o}return c(e,t),e.prototype.accept=function(e){return t.prototype.accept.call(this,e),e.visitRuntimeError(this)},e}(p),v=function(t){function e(r,n,i){var o=t.call(this,r,n,i)||this;return Object.setPrototypeOf(o,e.prototype),o.name="EqualUnexpectedError",o}return c(e,t),e.prototype.accept=function(e){return t.prototype.accept.call(this,e),e.visitUnexpectedError(this)},e}(p),y=function(){function t(t){this.mode=t,this._hasError=!1,this.errors=[]}return t.prototype.getErrorStatus=function(){return this._hasError},t.prototype.reportError=function(t){console.error((new u).print(t)),this._hasError=!0,this.errors.push(t)},t.prototype.handleError=function(t){var e;"VERBOSE"==this.mode&&console.debug("Error",t),e=t instanceof p?t:new v(t.message),console.error((new u).print(e)),this._hasError=!0,this.errors.push(e)},t}(),d=function(){function t(t,e){this.mode=t,this.errHandler=e,this.source="",this.line=1,this.tokens=[],this.leftPointer=0,this.rightPointer=0}return t.prototype.lex=function(t,e){var r=this;this.source=t,this.path=e;for(var n=!1;!this.atEnd();){var i=this.source[this.rightPointer];switch(this.leftPointer=this.rightPointer,i){case"<":this.condForward("!--",3)?(this.rightPointer++,this.comment()):(this.condForward("/")?this.pushToken("END_TAG_LEFT"):this.pushToken("START_TAG_LEFT"),n=!0,this.rightPointer++,this.tagname());break;case">":this.pushToken("TAG_RIGHT"),n=!1;break;case"=":n&&(this.pushToken("EQUAL_SIGN"),this.rightPointer++,this.value());break;case"/":n&&">"==this.lookAhead()&&this.rightPointer++;break;case"\n":this.line++;break;case" ":case"\t":case"\r":break;default:n?this.pushToken("ATTRIBUTE",this.consumeWhile((function(t){return"="!=t&&!r.endOfTag(t)&&!r.isWhitespace(t)}))):this.pushToken("TEXT",this.consumeWhile((function(t){return"<"!=t})).trim())}this.rightPointer++}return this.pushToken("EOF"),this.tokens},t.prototype.tagname=function(){var t=this;this.pushToken("TAGNAME",this.consumeWhile((function(e){return!t.isWhitespace(e)&&!t.endOfTag(e)})))},t.prototype.value=function(){var t,e=this,r=this.source[this.rightPointer];this.isWhitespace(r)&&(this.consumeWhile((function(t){return e.isWhitespace(t)})),this.rightPointer++,r=this.source[this.rightPointer]),'"'==r?(this.rightPointer++,t=this.consumeWhile((function(t){return'"'!=t})),this.rightPointer++):"'"==r?(this.rightPointer++,t=this.consumeWhile((function(t){return"'"!=t})),this.rightPointer++):t=this.consumeWhile((function(t){return!e.isWhitespace(t)&&!e.endOfTag(t)})),this.pushToken("VALUE",t)},t.prototype.comment=function(){var t=this;this.consumeWhile((function(e){return!("-"==e&&t.condForward("->",2))})),this.rightPointer++},t.prototype.handleNewline=function(){var t=this.source[this.rightPointer];"\r"==t&&this.line++,"\n"==t&&"\r"!=this.lookBehind()&&this.line++},t.prototype.consumeWhile=function(t){this.leftPointer=this.rightPointer;for(var e=this.source[this.rightPointer],r=t(e);!this.atEnd()&&r;)this.handleNewline(),this.rightPointer++,r=t(e=this.source[this.rightPointer]);var n=this.source.slice(this.leftPointer,this.rightPointer);return this.rightPointer--,n},t.prototype.condForward=function(t,e){return void 0===e&&(e=1),!this.atEnd(e)&&t==this.source.slice(this.rightPointer+1,this.rightPointer+e+1)&&(this.rightPointer+=e,!0)},t.prototype.lookAhead=function(t){return void 0===t&&(t=1),this.atEnd(t)?"":this.source.slice(this.rightPointer+1,this.rightPointer+t+1)},t.prototype.lookBehind=function(){return this.atEnd(-1)?"":this.source[this.rightPointer-1]},t.prototype.atEnd=function(t){return void 0===t&&(t=0),this.rightPointer+t>this.source.length-1},t.prototype.isWhitespace=function(t){return" "==t||"\t"==t||"\r"==t},t.prototype.endOfTag=function(t){return">"==t||"/"==t&&">"==this.lookAhead()},t.prototype.pushToken=function(t,e){this.tokens.push(new o(t,this.line,e))},t.prototype.reportError=function(t){var e=new l(t,this.path,this.line);this.errHandler.reportError(e)},t}(),m=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),T=function(){function t(){}return t.prototype.accept=function(t){if(void 0===(e=t).visitBinary||void 0===e.visitLogical||void 0===e.visitUnary||void 0===e.visitLiteral||void 0===e.visitVariable||void 0===e.visitCall)throw new Error("Invalid visitor type");var e},t}(),E=function(t){function e(e,r,n){var i=t.call(this)||this;return i.operator=e,i.arg1=r,i.arg2=n,i}return m(e,t),e.prototype.accept=function(e){return t.prototype.accept.call(this,e),e.visitBinary(this)},e}(T),g=function(t){function e(e,r,n){var i=t.call(this)||this;return i.operator=e,i.arg1=r,i.arg2=n,i}return m(e,t),e.prototype.accept=function(e){return t.prototype.accept.call(this,e),e.visitLogical(this)},e}(T),b=function(t){function e(e,r){var n=t.call(this)||this;return n.operator=e,n.arg1=r,n}return m(e,t),e.prototype.accept=function(e){return t.prototype.accept.call(this,e),e.visitUnary(this)},e}(T),A=function(t){function e(e){var r=t.call(this)||this;return r.arg=e,r}return m(e,t),e.prototype.accept=function(e){return t.prototype.accept.call(this,e),e.visitLiteral(this)},e}(T),S=function(t){function e(e){var r=t.call(this)||this;return r.name=e,r}return m(e,t),e.prototype.accept=function(e){return t.prototype.accept.call(this,e),e.visitVariable(this)},e}(T),w=function(t){function e(e,r){var n=t.call(this)||this;return n.calleeName=e,n.args=r,n}return m(e,t),e.prototype.accept=function(e){return t.prototype.accept.call(this,e),e.visitCall(this)},e}(T),_=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),x=function(){function t(){}return t.prototype.accept=function(t){if(void 0===(e=t).visitScope||void 0===e.visitAssignment||void 0===e.visitLoop||void 0===e.visitConditionalStatement||void 0===e.visitExpressionStatement||void 0===e.visitPrintStatement||void 0===e.visitFunctionDeclaration||void 0===e.visitReturnStatement)throw new Error("Invalid visitor type");var e},t}(),k=function(t){function e(e){var r=t.call(this)||this;return r.statements=e,r}return _(e,t),e.prototype.accept=function(e){return t.prototype.accept.call(this,e),e.visitScope(this)},e}(x),P=function(t){function e(e,r,n){var i=t.call(this)||this;return i.name=e,i.expression=r,i.scope=n,i}return _(e,t),e.prototype.accept=function(e){return t.prototype.accept.call(this,e),e.visitAssignment(this)},e}(x),O=function(t){function e(e,r){var n=t.call(this)||this;return n.condition=e,n.statements=r,n}return _(e,t),e.prototype.accept=function(e){return t.prototype.accept.call(this,e),e.visitLoop(this)},e}(x),L=function(t){function e(e,r){var n=t.call(this)||this;return n.conditions=e,n.statements=r,n}return _(e,t),e.prototype.accept=function(e){return t.prototype.accept.call(this,e),e.visitConditionalStatement(this)},e}(x),N=function(t){function e(e){var r=t.call(this)||this;return r.expression=e,r}return _(e,t),e.prototype.accept=function(e){return t.prototype.accept.call(this,e),e.visitExpressionStatement(this)},e}(x),R=function(t){function e(e){var r=t.call(this)||this;return r.expressions=e,r}return _(e,t),e.prototype.accept=function(e){return t.prototype.accept.call(this,e),e.visitPrintStatement(this)},e}(x),G=function(t){function e(e,r,n){var i=t.call(this)||this;return i.name=e,i.params=r,i.body=n,i}return _(e,t),e.prototype.accept=function(e){return t.prototype.accept.call(this,e),e.visitFunctionDeclaration(this)},e}(x),U=function(t){function e(e){var r=t.call(this)||this;return r.expression=e,r}return _(e,t),e.prototype.accept=function(e){return t.prototype.accept.call(this,e),e.visitReturnStatement(this)},e}(x);function D(t){return isNaN(Number(t))?"true"===t||"false"==t?"true"===t:t:Number(t)}!function(t){t.VERBOSE="VERBOSE",t.NORMAL="NORMAL"}(h||(h={}));var F,B=(new Map).set("div",[]).set("h1",["class"]).set("h2",["class"]).set("h3",["class"]).set("h4",["class"]).set("h5",["class"]).set("h6",["class"]).set("p",["class"]).set("a",["id","href","class"]).set("input",["type","value","id"]).set("form",["title","id"]).set("label",["for"]).set("link",["rel","href","type"]).set("span",[]),I=function(t,e,r,n){this.type=t,this.name=e,this.attribute=r,this.line=n};!function(t){t.START_TAG="START_TAG",t.END_TAG="END_TAG",t.TEXT="TEXT"}(F||(F={}));var H=function(){function t(t,e){this.mode=t,this.errHandler=e,this.pointer=0,this.statements=[]}return t.prototype.parse=function(t,e){for(this.path=e,this.tokens=function(t,e,r){for(var n=[],i=0,o=[],s=[],h=[],a=!1,c=!1;i<=t.length-1;){var u=t[i];"START_TAG_LEFT"==u.tokenType?(v(s),a=!0):"END_TAG_LEFT"==u.tokenType?(v(s),c=!0):"TAG_RIGHT"==u.tokenType?a&&c?y("Missing right tag",u.line):a||c?a?(p(o),a=!1):c&&(f(h),c=!1):y("Extra right tag",u.line):"EOF"==u.tokenType?v(s):a?o.push(u):c?h.push(u):s.push(u),i++}return(a||c)&&d("Unclosed tag",t[t.length-1].line),n;function p(t){if(0!=t.length){o=[];var e=t[0].value;e||y("Missing tagname",t[0].line);var r=B.get(e);if(null!=r){for(var i={},s=1,h="",a="";s<t.length;)t[s]&&"ATTRIBUTE"==t[s].tokenType&&r.includes(t[s].value)&&(h=t[s].value,t[++s]&&"EQUAL_SIGN"==t[s].tokenType?s++:y("Missing equal sign",t[s-1].line),t[s]&&"VALUE"==t[s].tokenType&&(null==t[s].value?y("Undefined value",t[s].line):a=t[s].value,s++),i[h]=a,h="",a="");n.push(new I("START_TAG",e,i,t[t.length-1].line))}}}function f(t){if(0!=t.length){h=[],t.length>1&&d("Extra attributes in end tag",t[0].line);var e=t[0].value;e||y("Missing tagname",t[0].line),n.push(new I("END_TAG",e,{},t[0].line))}}function v(t){if(0!=t.length){s=[],t.length>1&&d("Extra attributes in text",t[0].line);var e=t[0].value;void 0===e&&y("The value of a literal cannot be undefined",t[0].line),n.push(new I("TEXT",void 0,{value:D(e)},t[0].line))}}function y(t,r){throw new l(t,e,r)}function d(t,n){var i=new l(t,e,n);r.reportError(i)}}(t,this.path,this.errHandler),"VERBOSE"==this.mode&&console.debug("bigTokens",this.tokens);!this.atEnd();)this.statements.push(this.statement());return this.statements},t.prototype.statement=function(){return this.scope()},t.prototype.scope=function(){if(this.match("START_TAG","div",{})){for(var t=[];!this.match("END_TAG","div",{});)t.push(this.statement());return new k(t)}return this.assignment()},t.prototype.assignment=function(){var t=this;if(this.match("START_TAG","a",{})){var e=this.retPrevAttrE("id"),r="global"==this.retPrevAttr("class")?"global":void 0;this.checkString(e,"a id");var n=this.expression();return this.force((function(){return t.match("END_TAG","a",{})})),new P(e,n,r)}return this.functionDeclaration()},t.prototype.functionDeclaration=function(){var t=this;if(this.match("START_TAG","form",{id:void 0})){var e=this.retPrevAttrE("id");this.checkString(e,"function name");for(var r=[];this.match("START_TAG","input",{});){var n=this.retPrevAttrE("id");this.checkString(n,"input id"),r.push(n)}var i=[];for(this.force((function(){return t.match("START_TAG","div",{})}));!this.match("END_TAG","div",{});)i.push(this.statement());return this.force((function(){return t.match("END_TAG","form",{})})),new G(e,r,i)}return this.returnStatement()},t.prototype.returnStatement=function(){return this.match("START_TAG","input",{type:["submit"]})?new U(this.expression()):this.loop()},t.prototype.loop=function(){if(this.match("START_TAG","p",{})){for(var t=[],e=this.expression();!this.match("END_TAG","p",{});)t.push(this.statement());return new O(e,t)}return this.conditionalStatement()},t.prototype.conditionalStatement=function(){if(this.match("START_TAG","h1",{})){for(var t=[],e=[],r=[],n=this.expression();!this.match("END_TAG","h1",{});)r.push(this.statement());t.push(r),e.push(n);for(var i=2;i<=5;i++)if(this.match("START_TAG","h"+i,{})){for(n=this.expression(),r=[];!this.match("END_TAG","h"+i,{});)r.push(this.statement());t.push(r),e.push(n)}if(this.match("START_TAG","h6",{})){for(r=[];!this.match("END_TAG","h6",{});)r.push(this.statement());t.push(r)}return new L(e,t)}return this.printStatement()},t.prototype.printStatement=function(){var t=[];if(this.match("START_TAG","span",{})){for(;!this.match("END_TAG","span",{});)t.push(this.expression());return new R(t)}return this.expressionStatement()},t.prototype.expressionStatement=function(){return new N(this.expression())},t.prototype.expression=function(){return this.logic()},t.prototype.logic=function(){return this.retNestedLogicalExpr(["&&","||"],this.equality.bind(this))},t.prototype.equality=function(){return this.retBinaryExpr(["==","!="],this.comparsion.bind(this))},t.prototype.comparsion=function(){return this.retBinaryExpr([">","<"],this.addition.bind(this))},t.prototype.addition=function(){return this.retNestedBinaryExpr(["+","-"],this.multiplication.bind(this))},t.prototype.multiplication=function(){return this.retNestedBinaryExpr(["*","/"],this.unary.bind(this))},t.prototype.unary=function(){if(this.matchStartForm(["!"])){var t=this.retOperator();this.force(this.matchStartLabel);var e=this.expression();return this.force(this.matchEndLabel),this.force(this.matchEndForm),new b(t,e)}return this.call()},t.prototype.call=function(){if(this.match("START_TAG","form",{})){var t=this.retPrevAttrE("title");this.checkString(t,"callee name");var e=[];if(this.matchStartLabel())for(;!this.matchEndLabel();){var r=this.expression();e.push(r)}return this.force(this.matchEndForm),new w(t,e)}return this.primary()},t.prototype.primary=function(){var t=this;if(this.matchText())return new A(this.retPrevAttrE("value"));this.force((function(){return t.match("START_TAG","a",{})}));var e=this.retPrevAttrE("href");return this.checkString(e,"a href"),this.force((function(){return t.match("END_TAG","a",{})})),new S(e)},t.prototype.retBinaryExpr=function(t,e){if(this.matchStartForm(t)){var r=this.retOperator();this.force(this.matchStartLabel);var n=this.expression();this.force(this.matchEndLabel),this.force(this.matchStartLabel);var i=this.expression();return this.force(this.matchEndLabel),this.force(this.matchEndForm),new E(r,n,i)}return e()},t.prototype.retNestedExpr=function(t,e,r){if(this.matchStartForm(t)){var n=this.retOperator();this.force(this.matchStartLabel);var i=this.expression();this.force(this.matchEndLabel),this.force(this.matchStartLabel);var o=this.expression();this.force(this.matchEndLabel);for(var s=new r(n,i,o);this.matchStartLabel();)s=new r(n,s,this.expression()),this.force(this.matchEndLabel);return this.force(this.matchEndForm),s}return e()},t.prototype.retNestedBinaryExpr=function(t,e){return this.retNestedExpr(t,e,E)},t.prototype.retNestedLogicalExpr=function(t,e){return this.retNestedExpr(t,e,g)},t.prototype.match=function(t,e,r){var n;if(this.atEnd())return!1;if((n=this.tokens[this.pointer]).type===t&&n.name===e){for(var i in r)if(null==r[i]){if(!n.attribute[i])return!1}else if(!r[i].includes(n.attribute[i]))return!1;return this.pointer++,!0}return!1},t.prototype.matchStartForm=function(t){return this.match("START_TAG","form",{title:t})},t.prototype.matchStartLabel=function(){return this.match("START_TAG","label",{})},t.prototype.matchText=function(){return this.match("TEXT",void 0,{})},t.prototype.matchEndLabel=function(){return this.match("END_TAG","label",{})},t.prototype.matchEndForm=function(){return this.match("END_TAG","form",{})},t.prototype.force=function(t){if(!t.bind(this)()){this.pointer>this.tokens.length-1&&this.throwError("Unexpected EOF",this.tokens[this.tokens.length-1].line);var e,r=this.tokens[this.pointer];e="START_TAG"==r.type?"start "+r.name:"END_TAG"==r.type?"end "+r.name:"text",this.throwError("Unexpected "+e,this.tokens[this.pointer].line)}return!0},t.prototype.retPrevAttr=function(t){return this.tokens[this.pointer-1].attribute[t]},t.prototype.retPrevAttrE=function(t){var e=this.retPrevAttr(t);return void 0===e&&this.throwError("Value of attribute "+t+" cannot be undefined",this.tokens[this.pointer-1].line),e},t.prototype.retOperator=function(){var t=a.get(this.retPrevAttrE("title"));return void 0===t&&this.throwError("Operator cannot be undefined",this.tokens[this.pointer].line),t},t.prototype.atEnd=function(t){return void 0===t&&(t=0),this.pointer+t>this.tokens.length-1},t.prototype.checkString=function(t,e){"string"!=typeof t&&this.throwError("String value expected for "+e,this.tokens[this.pointer].line)},t.prototype.throwError=function(t,e){throw new l(t,this.path,e)},t.prototype.reportError=function(t,e){this.errHandler.reportError(new l(t,this.path,e))},t}(),M=function(){function t(t){this.variables=new Map,this.functions=new Map,this.outerEnv=t}return t.prototype.assign=function(t,e){this.variables.set(t,e)},t.prototype.get=function(t){var e=this.variables.get(t);if(null==e&&null!=this.outerEnv&&(e=this.outerEnv.get(t)),null==e)throw new f("Undefined variable "+t);return e},t.prototype.declareFunc=function(t,e){this.functions.set(t,e)},t.prototype.getFunc=function(t){var e=this.functions.get(t);if(null==e)throw new f("Undeclared function "+t);return e},t}(),j=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),V=function(){function t(t){this.declaration=t}return t.prototype.arity=function(){return this.declaration.params.length},t.prototype.call=function(t,e){for(var r=new M(t.environment),n=0;n<=e.length-1;n++)r.assign(this.declaration.params[n],e[n]);try{t.publicExecBlock(this.declaration.body,r)}catch(t){return t.val}return 0},t}(),W=function(t){function e(r){var n=t.call(this)||this;return Object.setPrototypeOf(n,e.prototype),n.name="returnVal",n.val=r,n}return j(e,t),e}(Error),q=function(){function t(t,e,r,n){this.mode=t,this.errHandler=e,this.pointer=0;var i=new M;this.environment=i,this.global=i,this.printer=r,this.input=n}return t.prototype.interpret=function(t,e){for(this.path=e,this.statements=t,"VERBOSE"==this.mode&&console.debug("Statements",this.statements);!(this.pointer>this.statements.length-1);){var r=this.statements[this.pointer];this.exec(r),this.pointer++}"VERBOSE"==this.mode&&console.debug("GlobalEnvironment",this.environment)},t.prototype.visitBinary=function(t){var e=this.eval(t.arg1),r=this.eval(t.arg2);switch(t.operator){case"EQUAL":return e===r;case"NOT_EQUAL":return e!==r;case"GREATER_THAN":return this.checkType(e,["number"]),this.checkType(r,["number"]),e>r;case"LESSER_THAN":return this.checkType(e,["number"]),this.checkType(r,["number"]),e<r;case"PLUS":return this.checkType(e,["number"]),this.checkType(r,["number"]),e+r;case"MINUS":return this.checkType(e,["number"]),this.checkType(r,["number"]),e-r;case"MULTIPLY":return this.checkType(e,["number"]),this.checkType(r,["number"]),e*r;case"DIVIDE":if(this.checkType(e,["number"]),this.checkType(r,["number"]),0==r)throw new f("Division by zero",this.path);return e/r;default:throw new f("Binary operator does not exist",this.path)}},t.prototype.visitLogical=function(t){var e,r=this.eval(t.arg1);switch(t.operator){case"AND":return this.checkType(r,["boolean"]),!0===r&&(e=this.eval(t.arg2),this.checkType(e,["boolean"]),e);case"OR":return this.checkType(r,["boolean"]),!1!==r||(e=this.eval(t.arg2),this.checkType(e,["boolean"]),e);default:throw new f("Logical operator does not exist",this.path)}},t.prototype.visitUnary=function(t){var e=this.eval(t.arg1);if("NOT"===t.operator)return this.checkType(e,["boolean"]),!e;throw new f("Operator does not exist",this.path)},t.prototype.visitCall=function(t){var e,r=this.global.getFunc(t.calleeName);if(void 0===(e=r).arity||void 0===e.call)throw new f("Object is not callable",this.path);for(var n=[],i=0;i<=t.args.length-1;i++){var o=this.eval(t.args[i]);this.checkType(o,["string","number","boolean"]),n.push(o)}if(n.length!=r.arity())throw new f("Expected "+r.arity()+" arguments, got "+n.length);return r.call(this,n)},t.prototype.visitLiteral=function(t){return this.checkType(t.arg,["string","number","boolean"]),t.arg},t.prototype.visitVariable=function(t){return this.environment.get(t.name)},t.prototype.visitScope=function(t){this.execBlock(t.statements,new M(this.environment))},t.prototype.visitAssignment=function(t){"global"==t.scope?this.global.assign(t.name,this.eval(t.expression)):this.environment.assign(t.name,this.eval(t.expression))},t.prototype.visitFunctionDeclaration=function(t){var e=new V(t);this.global.declareFunc(t.name,e)},t.prototype.visitReturnStatement=function(t){if(this.environment==this.global)throw new f("No return statement allowed in global scope",this.path);throw new W(this.eval(t.expression))},t.prototype.visitExpressionStatement=function(t){this.eval(t.expression)},t.prototype.visitConditionalStatement=function(t){for(var e=-1,r=0;r<t.conditions.length;r++)if(!0===this.eval(t.conditions[r])){e=r;break}if(-1==e&&t.statements.length==t.conditions.length+1&&(e=t.statements.length-1),-1!=e)for(var n=0;n<=t.statements[e].length-1;n++)this.exec(t.statements[e][n])},t.prototype.visitLoop=function(t){for(var e=this.eval(t.condition);!0===e;){for(var r=0;r<=t.statements.length-1;r++)this.exec(t.statements[r]);e=this.eval(t.condition)}},t.prototype.visitPrintStatement=function(t){for(var e=0;e<=t.expressions.length-1;e++)this.printer.print(this.eval(t.expressions[e]))},t.prototype.eval=function(t){return t.accept(this)},t.prototype.exec=function(t){return t.accept(this)},t.prototype.execBlock=function(t,e){var r=this.environment;this.environment=e;try{for(var n=0;n<=t.length-1;n++)this.exec(t[n])}catch(t){throw t}finally{this.environment=r}},t.prototype.checkType=function(t,e){for(var r=0,n=e;r<n.length;r++)if(typeof t==n[r])return!0;throw new f("Unexpected type "+typeof t,this.path)},t.prototype.publicExecBlock=function(t,e){return this.execBlock(t,e)},t}(),C=function(){function t(t){this.buffer="",this.allText="",this.outputMethod=t||console.log}return t.prototype.print=function(t){this.outputMethod(t),this.allText+=t+"\n"},t.prototype.bufferedPrint=function(t){this.buffer+=t+"\n"},t.prototype.flushBuffer=function(){this.buffer&&("\n"==this.buffer[this.buffer.length-1]&&(this.buffer=this.buffer.slice(0,this.buffer.length-1)),this.outputMethod(this.buffer))},t.prototype.allPrinted=function(){return"\n"==this.allText[this.allText.length-1]&&(this.allText=this.allText.slice(0,this.allText.length-1)),this.allText},t}(),Q=function(){function t(t,e,r,n,i){void 0===n&&(n=console.log);try{if(this.mode="VERBOSE"==e?"VERBOSE":"NORMAL",this.error=!1,this.path=null!=t?t:"Unknown",this.printer=new C(n),this.errHandler=new y(this.mode),this.lexer=new d(this.mode,this.errHandler),this.parser=new H(this.mode,this.errHandler),this.interpreter=new q(this.mode,this.errHandler,this.printer,i),null==t){if(null==r)throw new f("No source code found");this.source=r}else this.source=this.loadFile()}catch(t){this.errHandler.handleError(t)}}return t.prototype.run=function(){try{if(0==this.error){this.verbose("Running in verbose mode");var t=this.lexer.lex(this.source,this.path);this.verbose(t,"Tokens");var e=this.parser.parse(t,this.path);return this.error=this.errHandler.getErrorStatus(),this.execute(e,this.path),this.printer.allPrinted()}}catch(t){this.errHandler.handleError(t)}},t.prototype.loadFile=function(){if(this.verbose("Loading file at "+this.path),!e.existsSync(this.path))throw new f("Invalid path");return e.readFileSync(this.path,"utf8")},t.prototype.execute=function(t,e){try{0==this.error?(this.interpreter.interpret(t,e),this.printer.flushBuffer()):this.verbose(this.errHandler.errors,"Errors")}catch(t){this.errHandler.handleError(t)}},t.prototype.verbose=function(t,e){"VERBOSE"==this.mode&&(e?console.debug(e,t):console.debug(t))},t}()})(),equal=n})();